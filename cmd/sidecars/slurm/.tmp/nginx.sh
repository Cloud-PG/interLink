#!/bin/bash
#SBATCH --job-name=nginx
. ~/.bash_profile
module load singularity
export SINGULARITYENV_SINGULARITY_TMPDIR=$CINECA_SCRATCH
export SINGULARITYENV_SINGULARITY_CACHEDIR=$CINECA_SCRATCH
pwd; hostname; date

singularity exec  --env TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_PORT_9091_TCP=tcp://10.43.89.14:9091,KUBERNETES_PORT_443_TCP_PROTO=tcp,KSERVEUI_SERVICE_PORT_3000_TCP_PROTO=tcp,TEST01_PREDICTOR_DEFAULT_00001_PORT=tcp://10.43.104.135:80,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_SERVICE_PORT_HTTP_ISTIO=8012,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_PORT_80_TCP_PROTO=tcp,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_PORT_8012_TCP_PROTO=tcp,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_PORT_9090_TCP_PROTO=tcp,TEST01_PREDICTOR_DEFAULT_00001_PORT_80_TCP_PROTO=tcp,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_PORT_9090_TCP_PORT=9090,KUBERNETES_PORT_443_TCP_ADDR=10.43.0.1,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_SERVICE_PORT_HTTP=80,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_PORT_9091_TCP_PORT=9091,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_SERVICE_PORT_HTTP_AUTOMETRIC=9090,KUBERNETES_PORT_443_TCP_PORT=443,KSERVEUI_SERVICE_SERVICE_HOST=10.43.183.175,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_PORT_8012_TCP_ADDR=10.43.89.14,KUBERNETES_SERVICE_HOST=10.43.0.1,KUBERNETES_PORT=tcp://10.43.0.1:443,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_PORT=tcp://10.43.89.14:80,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_PORT_9090_TCP_ADDR=10.43.89.14,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_PORT_8012_TCP=tcp://10.43.89.14:8012,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_PORT_443_TCP_PROTO=tcp,KSERVEUI_SERVICE_PORT_3000_TCP_PORT=3000,TEST01_PREDICTOR_DEFAULT_00001_SERVICE_PORT_HTTP=80,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_SERVICE_PORT_HTTPS=443,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_PORT_80_TCP=tcp://10.43.89.14:80,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_SERVICE_PORT=80,TEST01_PREDICTOR_DEFAULT_00001_PORT_80_TCP_ADDR=10.43.104.135,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_PORT_8022_TCP_ADDR=10.43.89.14,TEST01_PREDICTOR_DEFAULT_00001_SERVICE_HOST=10.43.104.135,KSERVEUI_SERVICE_PORT=tcp://10.43.183.175:3000,TEST01_PREDICTOR_DEFAULT_00001_PORT_443_TCP_PROTO=tcp,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_PORT_9091_TCP_ADDR=10.43.89.14,TEST01_PREDICTOR_DEFAULT_00001_PORT_443_TCP_PORT=443,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_PORT_80_TCP_PORT=80,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_PORT_80_TCP_ADDR=10.43.89.14,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_SERVICE_HOST=10.43.89.14,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_PORT_8022_TCP_PROTO=tcp,KSERVEUI_SERVICE_SERVICE_PORT=3000,KUBERNETES_SERVICE_PORT_HTTPS=443,TEST01_PREDICTOR_DEFAULT_00001_SERVICE_PORT=80,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_PORT_443_TCP_PORT=443,TEST01_PREDICTOR_DEFAULT_00001_PORT_80_TCP_PORT=80,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_PORT_9091_TCP_PROTO=tcp,KSERVEUI_SERVICE_PORT_3000_TCP=tcp://10.43.183.175:3000,KUBERNETES_PORT_443_TCP=tcp://10.43.0.1:443,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_SERVICE_PORT_HTTP_USERMETRIC=9091,KSERVEUI_SERVICE_PORT_3000_TCP_ADDR=10.43.183.175,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_PORT_8022_TCP=tcp://10.43.89.14:8022,KUBERNETES_SERVICE_PORT=443,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_PORT_443_TCP_ADDR=10.43.89.14,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_PORT_443_TCP=tcp://10.43.89.14:443,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_PORT_9090_TCP=tcp://10.43.89.14:9090,TEST01_PREDICTOR_DEFAULT_00001_PORT_443_TCP=tcp://10.43.104.135:443,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_SERVICE_PORT_HTTP_QUEUEADM=8022,TEST01_PREDICTOR_DEFAULT_00001_PORT_443_TCP_ADDR=10.43.104.135,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_PORT_8012_TCP_PORT=8012,TEST01_PREDICTOR_DEFAULT_00001_SERVICE_PORT_HTTPS=443,TEST01_PREDICTOR_DEFAULT_00001_PRIVATE_PORT_8022_TCP_PORT=8022,TEST01_PREDICTOR_DEFAULT_00001_PORT_80_TCP=tcp://10.43.104.135:80 busybox echo Hello from container >> .knoc/nginx.out 2>> .knoc/nginx.err 
 echo $? > .knoc/nginx.status